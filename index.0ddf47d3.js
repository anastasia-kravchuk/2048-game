!function(){var t={};function e(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}t=/*#__PURE__*/function(){function t(r){e(this,t),this.board=r?structuredClone(r):Array.from({length:4},function(){return[,,,,].fill(0)}),this.initialState=structuredClone(this.board),this.score=0,this.gameStatus="idle"}return n(t,[{key:"start",value:function(){"idle"===this.gameStatus&&(this.gameStatus="playing",this.spawnRandomTile(),this.spawnRandomTile())}},{key:"restart",value:function(){this.board=structuredClone(this.initialState),this.score=0,this.gameStatus="idle"}},{key:"getState",value:function(){return this.board}},{key:"getScore",value:function(){return this.score}},{key:"getStatus",value:function(){return this.gameStatus}},{key:"spawnRandomTile",value:function(){for(var t=[],e=0;e<4;e++)for(var r=0;r<4;r++)0===this.board[e][r]&&t.push({i:e,j:r});if(!t.length)return null;var n=t[Math.floor(Math.random()*t.length)],i=n.i,o=n.j;this.board[i][o]=.9>Math.random()?2:4}},{key:"reverseRows",value:function(t){return t.map(function(t){return((function(t){if(Array.isArray(t))return i(t)})(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,void 0);var r=Object.prototype.toString.call(t).slice(8,-1);if("Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).reverse()})}},{key:"rotateLeft",value:function(t){return t[0].map(function(e,r){return t.map(function(t){return t[r]}).reverse()})}},{key:"rotateRight",value:function(t){return t[0].map(function(e,r){return t.map(function(t){return t[t.length-1-r]})})}},{key:"moveWithMeta",value:function(t){if("playing"!==this.gameStatus)return null;for(var e=structuredClone(this.board),r={moves:[],merges:[]},n=function(e,r){return"left"===t?{r:e,c:r}:"right"===t?{r:e,c:3-r}:"up"===t?{r:r,c:e}:{r:3-r,c:e}},i=Array.from({length:4},function(){return[,,,,].fill(0)}),o=0;o<4;o++){for(var a=[],s=[],u=0;u<4;u++){var l=n(o,u),c=l.r,h=l.c,f=this.board[c][h];0!==f&&(a.push(f),s.push({r:c,c:h}))}for(var d=0,v=0;v<a.length;v++){var m=a[v],y=a[v+1];if(void 0!==y&&m===y){var g=2*m,p=n(o,d);i[p.r][p.c]=g,this.score+=g,r.moves.push({from:s[v],to:p}),r.moves.push({from:s[v+1],to:p}),r.merges.push({at:p,value:g}),v++,d++}else{var S=n(o,d);i[S.r][S.c]=m,r.moves.push({from:s[v],to:S}),d++}}}return JSON.stringify(e)!==JSON.stringify(i)?(this.board=i,this.spawnRandomTile(),this.board.some(function(t){return t.includes(2048)})&&(this.gameStatus="win"),"win"!==this.gameStatus&&this.checkLose()&&(this.gameStatus="lose"),{meta:r,prevBoard:e,nextBoard:structuredClone(this.board)}):null}},{key:"checkLose",value:function(){for(var t,e,r=0;r<4;r++)for(var n=0;n<4;n++)if(0===this.board[r][n]||this.board[r][n]===(null===(t=this.board[r])||void 0===t?void 0:t[n+1])||this.board[r][n]===(null===(e=this.board[r+1])||void 0===e?void 0:e[n]))return!1;return!0}}]),t}();var o={},a={};a=/*#__PURE__*/function(){function t(r,n,i){e(this,t),this.value=r,this.row=n,this.col=i,this.element=document.createElement("div"),this.element.className="tile",this.inner=document.createElement("div"),this.inner.className="tile-inner tile--".concat(r),this.inner.textContent=r,this.element.appendChild(this.inner),this.setPosition()}return n(t,[{key:"setPosition",value:function(){var t=85*this.col,e=85*this.row;this.element.style.transform="translate(".concat(t,"px, ").concat(e,"px)")}},{key:"moveTo",value:function(t,e){this.row=t,this.col=e,this.setPosition()}},{key:"updateValue",value:function(t){this.value=t,this.inner.textContent=t,this.inner.className="tile-inner tile--".concat(t)}},{key:"remove",value:function(){this.element.remove()}}]),t}(),o=/*#__PURE__*/function(){function t(r,n,i){e(this,t),this.game=r,this.tilesLayer=n,this.gameField=i,this.tiles=[]}return n(t,[{key:"reset",value:function(){this.tiles.forEach(function(t){return t.remove()}),this.tiles=[]}},{key:"getCellPosition",value:function(t,e){return{x:85*e,y:85*t}}},{key:"spawnTile",value:function(t,e,r){var n=new a(t,e,r),i=this.getCellPosition(e,r);return n.setPosition(i.x,i.y),this.tiles.push(n),this.tilesLayer.appendChild(n.element),n}},{key:"getTileAt",value:function(t,e){return this.tiles.find(function(r){return r.row===t&&r.col===e})}},{key:"syncInitial",value:function(t){this.reset();for(var e=0;e<4;e++)for(var r=0;r<4;r++)0!==t[e][r]&&this.spawnTile(t[e][r],e,r)}},{key:"applyMoves",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.moves[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=this.getTileAt(a.from.r,a.from.c);if(s){s.row=a.to.r,s.col=a.to.c;var u=this.getCellPosition(s.row,s.col);s.setPosition(u.x,u.y)}}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"applyMerges",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.merges[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=this.getTileAt(a.at.r,a.at.c);s&&s.updateValue(a.value)}}catch(t){r=!0,n=t}finally{try{e||null==o.return||o.return()}finally{if(r)throw n}}}}]),t}(),document.addEventListener("DOMContentLoaded",function(){var e=function(){i.textContent=String(r.getScore()),a.classList.toggle("hidden","idle"!==r.getStatus()),s.classList.toggle("hidden","win"!==r.getStatus()),u.classList.toggle("hidden","lose"!==r.getStatus()),"idle"===r.getStatus()?(n.textContent="Start",n.classList.add("start"),n.classList.remove("restart")):(n.textContent="Restart",n.classList.add("restart"),n.classList.remove("start"))},r=new t,n=document.querySelector(".button"),i=document.querySelector(".game-score"),a=document.querySelector(".message.message-start"),s=document.querySelector(".message.message-win"),u=document.querySelector(".message.message-lose"),l=document.querySelector(".game-field"),c=document.querySelector(".tiles-layer"),h=new o(r,c,l),f={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"},d=!1;n.addEventListener("click",function(){"idle"===r.getStatus()?r.start():r.restart(),h.syncInitial(r.getState()),e()}),document.addEventListener("keydown",function(t){var n=f[t.key];if(n&&(t.preventDefault(),!d&&"playing"===r.getStatus())){var i=r.moveWithMeta(n);i&&(d=!0,h.applyMoves(i.meta),setTimeout(function(){h.syncInitial(r.getState()),e(),d=!1},160))}}),e()})}();
//# sourceMappingURL=index.0ddf47d3.js.map
