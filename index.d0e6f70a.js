var t={};t=class{constructor(t){this.board=t?structuredClone(t):Array.from({length:4},()=>[,,,,].fill(0)),this.initialState=structuredClone(this.board),this.score=0,this.gameStatus="idle"}start(){"idle"===this.gameStatus&&(this.gameStatus="playing",this.spawnRandomTile(),this.spawnRandomTile())}restart(){this.board=structuredClone(this.initialState),this.score=0,this.gameStatus="idle"}getState(){return this.board}getScore(){return this.score}getStatus(){return this.gameStatus}spawnRandomTile(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.board[e][s]&&t.push({i:e,j:s});if(!t.length)return null;let{i:e,j:s}=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.9>Math.random()?2:4}reverseRows(t){return t.map(t=>[...t].reverse())}rotateLeft(t){return t[0].map((e,s)=>t.map(t=>t[s]).reverse())}rotateRight(t){return t[0].map((e,s)=>t.map(t=>t[t.length-1-s]))}moveWithMeta(t){if("playing"!==this.gameStatus)return null;let e=structuredClone(this.board),s={moves:[],merges:[]},r=(e,s)=>"left"===t?{r:e,c:s}:"right"===t?{r:e,c:3-s}:"up"===t?{r:s,c:e}:{r:3-s,c:e},i=Array.from({length:4},()=>[,,,,].fill(0));for(let t=0;t<4;t++){let e=[],o=[];for(let s=0;s<4;s++){let{r:i,c:a}=r(t,s),l=this.board[i][a];0!==l&&(e.push(l),o.push({r:i,c:a}))}let a=0;for(let l=0;l<e.length;l++){let n=e[l],h=e[l+1];if(void 0!==h&&n===h){let e=2*n,h=r(t,a);i[h.r][h.c]=e,this.score+=e,s.moves.push({from:o[l],to:h}),s.moves.push({from:o[l+1],to:h}),s.merges.push({at:h,value:e}),l++,a++}else{let e=r(t,a);i[e.r][e.c]=n,s.moves.push({from:o[l],to:e}),a++}}}return JSON.stringify(e)!==JSON.stringify(i)?(this.board=i,this.spawnRandomTile(),this.board.some(t=>t.includes(2048))&&(this.gameStatus="win"),"win"!==this.gameStatus&&this.checkLose()&&(this.gameStatus="lose"),{meta:s,prevBoard:e,nextBoard:structuredClone(this.board)}):null}checkLose(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.board[t][e]||this.board[t][e]===this.board[t]?.[e+1]||this.board[t][e]===this.board[t+1]?.[e])return!1;return!0}};var e={},s={};s=class{constructor(t,e,s){this.value=t,this.row=e,this.col=s,this.element=document.createElement("div"),this.element.className="tile",this.inner=document.createElement("div"),this.inner.className=`tile-inner tile--${t}`,this.inner.textContent=t,this.element.appendChild(this.inner),this.setPosition()}setPosition(){let t=85*this.col,e=85*this.row;this.element.style.transform=`translate(${t}px, ${e}px)`}moveTo(t,e){this.row=t,this.col=e,this.setPosition()}updateValue(t){this.value=t,this.inner.textContent=t,this.inner.className=`tile-inner tile--${t}`}remove(){this.element.remove()}},e=class{constructor(t,e,s){this.game=t,this.tilesLayer=e,this.gameField=s,this.tiles=[]}reset(){this.tiles.forEach(t=>t.remove()),this.tiles=[]}getCellPosition(t,e){return{x:85*e,y:85*t}}spawnTile(t,e,r){let i=new s(t,e,r),o=this.getCellPosition(e,r);return i.setPosition(o.x,o.y),this.tiles.push(i),this.tilesLayer.appendChild(i.element),i}getTileAt(t,e){return this.tiles.find(s=>s.row===t&&s.col===e)}syncInitial(t){this.reset();for(let e=0;e<4;e++)for(let s=0;s<4;s++)0!==t[e][s]&&this.spawnTile(t[e][s],e,s)}applyMoves(t){for(let e of t.moves){let t=this.getTileAt(e.from.r,e.from.c);if(!t)continue;t.row=e.to.r,t.col=e.to.c;let s=this.getCellPosition(t.row,t.col);t.setPosition(s.x,s.y)}}applyMerges(t){for(let e of t.merges){let t=this.getTileAt(e.at.r,e.at.c);t&&t.updateValue(e.value)}}},document.addEventListener("DOMContentLoaded",()=>{let s=new t,r=document.querySelector(".button"),i=document.querySelector(".game-score"),o=document.querySelector(".message.message-start"),a=document.querySelector(".message.message-win"),l=document.querySelector(".message.message-lose"),n=document.querySelector(".game-field"),h=document.querySelector(".tiles-layer"),u=new e(s,h,n),c={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"},m=!1;function d(){i.textContent=String(s.getScore()),o.classList.toggle("hidden","idle"!==s.getStatus()),a.classList.toggle("hidden","win"!==s.getStatus()),l.classList.toggle("hidden","lose"!==s.getStatus()),"idle"===s.getStatus()?(r.textContent="Start",r.classList.add("start"),r.classList.remove("restart")):(r.textContent="Restart",r.classList.add("restart"),r.classList.remove("start"))}r.addEventListener("click",()=>{"idle"===s.getStatus()?s.start():s.restart(),u.syncInitial(s.getState()),d()}),document.addEventListener("keydown",t=>{let e=c[t.key];if(!e||(t.preventDefault(),m||"playing"!==s.getStatus()))return;let r=s.moveWithMeta(e);r&&(m=!0,u.applyMoves(r.meta),setTimeout(()=>{u.syncInitial(s.getState()),d(),m=!1},160))}),d()});
//# sourceMappingURL=index.d0e6f70a.js.map
