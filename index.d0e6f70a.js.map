{"mappings":"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","sources":["<anon>","src/scripts/main.js","src/modules/Game.class.js","src/modules/BoardView.js","src/modules/Tile.class.js"],"sourcesContent":["\"use strict\";\nvar $a5fd07fa01589658$exports = {};\n\"use strict\";\nclass $a5fd07fa01589658$var$Game {\n    constructor(initialState){\n        this.board = initialState ? structuredClone(initialState) : Array.from({\n            length: 4\n        }, ()=>Array(4).fill(0));\n        this.initialState = structuredClone(this.board);\n        this.score = 0;\n        this.gameStatus = \"idle\";\n    }\n    start() {\n        if (this.gameStatus !== \"idle\") return;\n        this.gameStatus = \"playing\";\n        this.spawnRandomTile();\n        this.spawnRandomTile();\n    }\n    restart() {\n        this.board = structuredClone(this.initialState);\n        this.score = 0;\n        this.gameStatus = \"idle\";\n    }\n    getState() {\n        return this.board;\n    }\n    getScore() {\n        return this.score;\n    }\n    getStatus() {\n        return this.gameStatus;\n    }\n    spawnRandomTile() {\n        const empty = [];\n        for(let i = 0; i < 4; i++){\n            for(let j = 0; j < 4; j++)if (this.board[i][j] === 0) empty.push({\n                i: i,\n                j: j\n            });\n        }\n        if (!empty.length) return null;\n        const { i: row, j: col } = empty[Math.floor(Math.random() * empty.length)];\n        this.board[row][col] = Math.random() < 0.9 ? 2 : 4;\n    }\n    reverseRows(board) {\n        return board.map((row)=>[\n                ...row\n            ].reverse());\n    }\n    rotateLeft(board) {\n        return board[0].map((_, i)=>board.map((row)=>row[i]).reverse());\n    }\n    rotateRight(board) {\n        return board[0].map((_, i)=>board.map((row)=>row[row.length - 1 - i]));\n    }\n    moveWithMeta(direction) {\n        if (this.gameStatus !== \"playing\") return null;\n        const prevBoard = structuredClone(this.board);\n        const meta = {\n            moves: [],\n            merges: []\n        };\n        const mapIndexToCell = (line, idx)=>{\n            if (direction === \"left\") return {\n                r: line,\n                c: idx\n            };\n            if (direction === \"right\") return {\n                r: line,\n                c: 3 - idx\n            };\n            if (direction === \"up\") return {\n                r: idx,\n                c: line\n            };\n            return {\n                r: 3 - idx,\n                c: line\n            }; // down\n        };\n        const newBoard = Array.from({\n            length: 4\n        }, ()=>Array(4).fill(0));\n        for(let line = 0; line < 4; line++){\n            const values = [];\n            const fromCells = [];\n            for(let idx = 0; idx < 4; idx++){\n                const { r: r, c: c } = mapIndexToCell(line, idx);\n                const v = this.board[r][c];\n                if (v !== 0) {\n                    values.push(v);\n                    fromCells.push({\n                        r: r,\n                        c: c\n                    });\n                }\n            }\n            let write = 0;\n            for(let i = 0; i < values.length; i++){\n                const cur = values[i];\n                const next = values[i + 1];\n                if (next !== undefined && cur === next) {\n                    const merged = cur * 2;\n                    const to = mapIndexToCell(line, write);\n                    newBoard[to.r][to.c] = merged;\n                    this.score += merged;\n                    meta.moves.push({\n                        from: fromCells[i],\n                        to: to\n                    });\n                    meta.moves.push({\n                        from: fromCells[i + 1],\n                        to: to\n                    });\n                    meta.merges.push({\n                        at: to,\n                        value: merged\n                    });\n                    i++;\n                    write++;\n                } else {\n                    const to = mapIndexToCell(line, write);\n                    newBoard[to.r][to.c] = cur;\n                    meta.moves.push({\n                        from: fromCells[i],\n                        to: to\n                    });\n                    write++;\n                }\n            }\n        }\n        const changed = JSON.stringify(prevBoard) !== JSON.stringify(newBoard);\n        if (!changed) return null;\n        this.board = newBoard;\n        this.spawnRandomTile();\n        if (this.board.some((row)=>row.includes(2048))) this.gameStatus = \"win\";\n        if (this.gameStatus !== \"win\" && this.checkLose()) this.gameStatus = \"lose\";\n        return {\n            meta: meta,\n            prevBoard: prevBoard,\n            nextBoard: structuredClone(this.board)\n        };\n    }\n    checkLose() {\n        for(let i = 0; i < 4; i++)for(let j = 0; j < 4; j++){\n            if (this.board[i][j] === 0) return false;\n            if (this.board[i][j] === this.board[i]?.[j + 1]) return false;\n            if (this.board[i][j] === this.board[i + 1]?.[j]) return false;\n        }\n        return true;\n    }\n}\n$a5fd07fa01589658$exports = $a5fd07fa01589658$var$Game;\n\n\nvar $8b99ade5ffa8e632$exports = {};\n\"use strict\";\nvar $a3a4bece0086b835$exports = {};\n\"use strict\";\nconst $a3a4bece0086b835$var$CELL_SIZE = 75;\nconst $a3a4bece0086b835$var$GAP = 10;\nconst $a3a4bece0086b835$var$STEP = $a3a4bece0086b835$var$CELL_SIZE + $a3a4bece0086b835$var$GAP;\nclass $a3a4bece0086b835$var$Tile {\n    constructor(value, row, col){\n        this.value = value;\n        this.row = row;\n        this.col = col;\n        this.element = document.createElement(\"div\");\n        this.element.className = \"tile\";\n        this.inner = document.createElement(\"div\");\n        this.inner.className = `tile-inner tile--${value}`;\n        this.inner.textContent = value;\n        this.element.appendChild(this.inner);\n        this.setPosition();\n    }\n    setPosition() {\n        const x = this.col * $a3a4bece0086b835$var$STEP;\n        const y = this.row * $a3a4bece0086b835$var$STEP;\n        this.element.style.transform = `translate(${x}px, ${y}px)`;\n    }\n    moveTo(row, col) {\n        this.row = row;\n        this.col = col;\n        this.setPosition();\n    }\n    updateValue(newValue) {\n        this.value = newValue;\n        this.inner.textContent = newValue;\n        this.inner.className = `tile-inner tile--${newValue}`;\n    }\n    remove() {\n        this.element.remove();\n    }\n}\n$a3a4bece0086b835$exports = $a3a4bece0086b835$var$Tile;\n\n\nclass $8b99ade5ffa8e632$var$BoardView {\n    constructor(game, tilesLayer, gameField){\n        this.game = game;\n        this.tilesLayer = tilesLayer;\n        this.gameField = gameField;\n        this.tiles = [];\n    }\n    reset() {\n        this.tiles.forEach((t)=>t.remove());\n        this.tiles = [];\n    }\n    getCellPosition(row, col) {\n        const CELL_SIZE = 75;\n        const GAP = 10;\n        return {\n            x: col * (CELL_SIZE + GAP),\n            y: row * (CELL_SIZE + GAP)\n        };\n    }\n    spawnTile(value, row, col) {\n        const tile = new $a3a4bece0086b835$exports(value, row, col);\n        const pos = this.getCellPosition(row, col);\n        tile.setPosition(pos.x, pos.y);\n        this.tiles.push(tile);\n        this.tilesLayer.appendChild(tile.element);\n        return tile;\n    }\n    getTileAt(row, col) {\n        return this.tiles.find((t)=>t.row === row && t.col === col);\n    }\n    syncInitial(board) {\n        this.reset();\n        for(let r = 0; r < 4; r++){\n            for(let c = 0; c < 4; c++)if (board[r][c] !== 0) this.spawnTile(board[r][c], r, c);\n        }\n    }\n    applyMoves(meta) {\n        for (const m of meta.moves){\n            const tile = this.getTileAt(m.from.r, m.from.c);\n            if (!tile) continue;\n            tile.row = m.to.r;\n            tile.col = m.to.c;\n            const pos = this.getCellPosition(tile.row, tile.col);\n            tile.setPosition(pos.x, pos.y);\n        }\n    }\n    applyMerges(meta) {\n        for (const m of meta.merges){\n            const tile = this.getTileAt(m.at.r, m.at.c);\n            if (!tile) continue;\n            tile.updateValue(m.value);\n        }\n    }\n}\n$8b99ade5ffa8e632$exports = $8b99ade5ffa8e632$var$BoardView;\n\n\ndocument.addEventListener(\"DOMContentLoaded\", ()=>{\n    const game = new $a5fd07fa01589658$exports();\n    const buttonEl = document.querySelector(\".button\");\n    const scoreEl = document.querySelector(\".game-score\");\n    const messageStartEl = document.querySelector(\".message.message-start\");\n    const messageWinEl = document.querySelector(\".message.message-win\");\n    const messageLoseEl = document.querySelector(\".message.message-lose\");\n    const gameField = document.querySelector(\".game-field\");\n    const tilesLayer = document.querySelector(\".tiles-layer\");\n    const boardView = new $8b99ade5ffa8e632$exports(game, tilesLayer, gameField);\n    const keyMap = {\n        ArrowLeft: \"left\",\n        ArrowRight: \"right\",\n        ArrowUp: \"up\",\n        ArrowDown: \"down\"\n    };\n    let isAnimating = false;\n    function updateUI() {\n        scoreEl.textContent = String(game.getScore());\n        messageStartEl.classList.toggle(\"hidden\", game.getStatus() !== \"idle\");\n        messageWinEl.classList.toggle(\"hidden\", game.getStatus() !== \"win\");\n        messageLoseEl.classList.toggle(\"hidden\", game.getStatus() !== \"lose\");\n        if (game.getStatus() === \"idle\") {\n            buttonEl.textContent = \"Start\";\n            buttonEl.classList.add(\"start\");\n            buttonEl.classList.remove(\"restart\");\n        } else {\n            buttonEl.textContent = \"Restart\";\n            buttonEl.classList.add(\"restart\");\n            buttonEl.classList.remove(\"start\");\n        }\n    }\n    buttonEl.addEventListener(\"click\", ()=>{\n        if (game.getStatus() === \"idle\") game.start();\n        else game.restart();\n        boardView.syncInitial(game.getState());\n        updateUI();\n    });\n    document.addEventListener(\"keydown\", (ev)=>{\n        const direction = keyMap[ev.key];\n        if (!direction) return;\n        ev.preventDefault();\n        if (isAnimating || game.getStatus() !== \"playing\") return;\n        const result = game.moveWithMeta(direction);\n        if (!result) return;\n        isAnimating = true;\n        boardView.applyMoves(result.meta);\n        setTimeout(()=>{\n            boardView.syncInitial(game.getState());\n            updateUI();\n            isAnimating = false;\n        }, 160);\n    });\n    updateUI();\n});\n\n\n//# sourceMappingURL=index.d0e6f70a.js.map\n","'use strict';\n\nconst Game = require('../modules/Game.class');\nconst BoardView = require('../modules/BoardView');\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const game = new Game();\n\n  const buttonEl = document.querySelector('.button');\n  const scoreEl = document.querySelector('.game-score');\n  const messageStartEl = document.querySelector('.message.message-start');\n  const messageWinEl = document.querySelector('.message.message-win');\n  const messageLoseEl = document.querySelector('.message.message-lose');\n\n  const gameField = document.querySelector('.game-field');\n  const tilesLayer = document.querySelector('.tiles-layer');\n\n  const boardView = new BoardView(game, tilesLayer, gameField);\n\n  const keyMap = {\n    ArrowLeft: 'left',\n    ArrowRight: 'right',\n    ArrowUp: 'up',\n    ArrowDown: 'down',\n  };\n\n  let isAnimating = false;\n\n  function updateUI() {\n    scoreEl.textContent = String(game.getScore());\n\n    messageStartEl.classList.toggle('hidden', game.getStatus() !== 'idle');\n    messageWinEl.classList.toggle('hidden', game.getStatus() !== 'win');\n    messageLoseEl.classList.toggle('hidden', game.getStatus() !== 'lose');\n\n    if (game.getStatus() === 'idle') {\n      buttonEl.textContent = 'Start';\n      buttonEl.classList.add('start');\n      buttonEl.classList.remove('restart');\n    } else {\n      buttonEl.textContent = 'Restart';\n      buttonEl.classList.add('restart');\n      buttonEl.classList.remove('start');\n    }\n  }\n\n  buttonEl.addEventListener('click', () => {\n    if (game.getStatus() === 'idle') {\n      game.start();\n    } else {\n      game.restart();\n    }\n\n    boardView.syncInitial(game.getState());\n    updateUI();\n  });\n\n  document.addEventListener('keydown', (ev) => {\n    const direction = keyMap[ev.key];\n\n    if (!direction) {\n      return;\n    }\n\n    ev.preventDefault();\n\n    if (isAnimating || game.getStatus() !== 'playing') {\n      return;\n    }\n\n    const result = game.moveWithMeta(direction);\n\n    if (!result) {\n      return;\n    }\n\n    isAnimating = true;\n\n    boardView.applyMoves(result.meta);\n\n    setTimeout(() => {\n      boardView.syncInitial(game.getState());\n      updateUI();\n      isAnimating = false;\n    }, 160);\n  });\n\n  updateUI();\n});\n","'use strict';\n\nclass Game {\n  constructor(initialState) {\n    this.board = initialState\n      ? structuredClone(initialState)\n      : Array.from({ length: 4 }, () => Array(4).fill(0));\n\n    this.initialState = structuredClone(this.board);\n    this.score = 0;\n    this.gameStatus = 'idle';\n  }\n\n  start() {\n    if (this.gameStatus !== 'idle') {\n      return;\n    }\n    this.gameStatus = 'playing';\n    this.spawnRandomTile();\n    this.spawnRandomTile();\n  }\n\n  restart() {\n    this.board = structuredClone(this.initialState);\n    this.score = 0;\n    this.gameStatus = 'idle';\n  }\n\n  getState() {\n    return this.board;\n  }\n\n  getScore() {\n    return this.score;\n  }\n\n  getStatus() {\n    return this.gameStatus;\n  }\n\n  spawnRandomTile() {\n    const empty = [];\n\n    for (let i = 0; i < 4; i++) {\n      for (let j = 0; j < 4; j++) {\n        if (this.board[i][j] === 0) {\n          empty.push({ i, j });\n        }\n      }\n    }\n\n    if (!empty.length) {\n      return null;\n    }\n\n    const { i: row, j: col } = empty[Math.floor(Math.random() * empty.length)];\n\n    this.board[row][col] = Math.random() < 0.9 ? 2 : 4;\n  }\n\n  reverseRows(board) {\n    return board.map((row) => [...row].reverse());\n  }\n\n  rotateLeft(board) {\n    return board[0].map((_, i) => board.map((row) => row[i]).reverse());\n  }\n\n  rotateRight(board) {\n    return board[0].map((_, i) => board.map((row) => row[row.length - 1 - i]));\n  }\n\n  moveWithMeta(direction) {\n    if (this.gameStatus !== 'playing') {\n      return null;\n    }\n\n    const prevBoard = structuredClone(this.board);\n    const meta = { moves: [], merges: [] };\n\n    const mapIndexToCell = (line, idx) => {\n      if (direction === 'left') {\n        return { r: line, c: idx };\n      }\n\n      if (direction === 'right') {\n        return { r: line, c: 3 - idx };\n      }\n\n      if (direction === 'up') {\n        return { r: idx, c: line };\n      }\n\n      return { r: 3 - idx, c: line }; // down\n    };\n\n    const newBoard = Array.from({ length: 4 }, () => Array(4).fill(0));\n\n    for (let line = 0; line < 4; line++) {\n      const values = [];\n      const fromCells = [];\n\n      for (let idx = 0; idx < 4; idx++) {\n        const { r, c } = mapIndexToCell(line, idx);\n        const v = this.board[r][c];\n\n        if (v !== 0) {\n          values.push(v);\n          fromCells.push({ r, c });\n        }\n      }\n\n      let write = 0;\n\n      for (let i = 0; i < values.length; i++) {\n        const cur = values[i];\n        const next = values[i + 1];\n\n        if (next !== undefined && cur === next) {\n          const merged = cur * 2;\n          const to = mapIndexToCell(line, write);\n\n          newBoard[to.r][to.c] = merged;\n          this.score += merged;\n\n          meta.moves.push({ from: fromCells[i], to });\n          meta.moves.push({ from: fromCells[i + 1], to });\n          meta.merges.push({ at: to, value: merged });\n\n          i++;\n          write++;\n        } else {\n          const to = mapIndexToCell(line, write);\n\n          newBoard[to.r][to.c] = cur;\n          meta.moves.push({ from: fromCells[i], to });\n          write++;\n        }\n      }\n    }\n\n    const changed = JSON.stringify(prevBoard) !== JSON.stringify(newBoard);\n\n    if (!changed) {\n      return null;\n    }\n\n    this.board = newBoard;\n    this.spawnRandomTile();\n\n    if (this.board.some((row) => row.includes(2048))) {\n      this.gameStatus = 'win';\n    }\n\n    if (this.gameStatus !== 'win' && this.checkLose()) {\n      this.gameStatus = 'lose';\n    }\n\n    return { meta, prevBoard, nextBoard: structuredClone(this.board) };\n  }\n\n  checkLose() {\n    for (let i = 0; i < 4; i++) {\n      for (let j = 0; j < 4; j++) {\n        if (this.board[i][j] === 0) {\n          return false;\n        }\n\n        if (this.board[i][j] === this.board[i]?.[j + 1]) {\n          return false;\n        }\n\n        if (this.board[i][j] === this.board[i + 1]?.[j]) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  }\n}\n\nmodule.exports = Game;\n","'use strict';\n\nconst Tile = require('./Tile.class');\n\nclass BoardView {\n  constructor(game, tilesLayer, gameField) {\n    this.game = game;\n    this.tilesLayer = tilesLayer;\n    this.gameField = gameField;\n    this.tiles = [];\n  }\n\n  reset() {\n    this.tiles.forEach((t) => t.remove());\n    this.tiles = [];\n  }\n\n  getCellPosition(row, col) {\n    const CELL_SIZE = 75;\n    const GAP = 10;\n\n    return {\n      x: col * (CELL_SIZE + GAP),\n      y: row * (CELL_SIZE + GAP),\n    };\n  }\n\n  spawnTile(value, row, col) {\n    const tile = new Tile(value, row, col);\n    const pos = this.getCellPosition(row, col);\n\n    tile.setPosition(pos.x, pos.y);\n\n    this.tiles.push(tile);\n    this.tilesLayer.appendChild(tile.element);\n\n    return tile;\n  }\n\n  getTileAt(row, col) {\n    return this.tiles.find((t) => t.row === row && t.col === col);\n  }\n\n  syncInitial(board) {\n    this.reset();\n\n    for (let r = 0; r < 4; r++) {\n      for (let c = 0; c < 4; c++) {\n        if (board[r][c] !== 0) {\n          this.spawnTile(board[r][c], r, c);\n        }\n      }\n    }\n  }\n\n  applyMoves(meta) {\n    for (const m of meta.moves) {\n      const tile = this.getTileAt(m.from.r, m.from.c);\n\n      if (!tile) {\n        continue;\n      }\n\n      tile.row = m.to.r;\n      tile.col = m.to.c;\n\n      const pos = this.getCellPosition(tile.row, tile.col);\n\n      tile.setPosition(pos.x, pos.y);\n    }\n  }\n\n  applyMerges(meta) {\n    for (const m of meta.merges) {\n      const tile = this.getTileAt(m.at.r, m.at.c);\n\n      if (!tile) {\n        continue;\n      }\n\n      tile.updateValue(m.value);\n    }\n  }\n}\n\nmodule.exports = BoardView;\n","'use strict';\n\nconst CELL_SIZE = 75;\nconst GAP = 10;\nconst STEP = CELL_SIZE + GAP;\n\nclass Tile {\n  constructor(value, row, col) {\n    this.value = value;\n    this.row = row;\n    this.col = col;\n\n    this.element = document.createElement('div');\n    this.element.className = 'tile';\n\n    this.inner = document.createElement('div');\n    this.inner.className = `tile-inner tile--${value}`;\n    this.inner.textContent = value;\n\n    this.element.appendChild(this.inner);\n\n    this.setPosition();\n  }\n\n  setPosition() {\n    const x = this.col * STEP;\n    const y = this.row * STEP;\n\n    this.element.style.transform = `translate(${x}px, ${y}px)`;\n  }\n\n  moveTo(row, col) {\n    this.row = row;\n    this.col = col;\n    this.setPosition();\n  }\n\n  updateValue(newValue) {\n    this.value = newValue;\n    this.inner.textContent = newValue;\n\n    this.inner.className = `tile-inner tile--${newValue}`;\n  }\n\n  remove() {\n    this.element.remove();\n  }\n}\n\nmodule.exports = Tile;\n"],"names":["$a5fd07fa01589658$exports","constructor","initialState","board","structuredClone","Array","from","length","fill","score","gameStatus","start","spawnRandomTile","restart","getState","getScore","getStatus","empty","i","j","push","row","col","Math","floor","random","reverseRows","map","reverse","rotateLeft","_","rotateRight","moveWithMeta","direction","prevBoard","meta","moves","merges","mapIndexToCell","line","idx","r","c","newBoard","values","fromCells","v","write","cur","next","undefined","merged","to","at","value","JSON","stringify","some","includes","checkLose","nextBoard","$8b99ade5ffa8e632$exports","$a3a4bece0086b835$exports","element","document","createElement","className","inner","textContent","appendChild","setPosition","x","$a3a4bece0086b835$var$CELL_SIZE","y","style","transform","moveTo","updateValue","newValue","remove","game","tilesLayer","gameField","tiles","reset","forEach","t","getCellPosition","CELL_SIZE","spawnTile","tile","pos","getTileAt","find","syncInitial","applyMoves","m","applyMerges","addEventListener","buttonEl","querySelector","scoreEl","messageStartEl","messageWinEl","messageLoseEl","boardView","keyMap","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","isAnimating","updateUI","String","classList","toggle","add","ev","key","preventDefault","result","setTimeout"],"version":3,"file":"index.d0e6f70a.js.map"}